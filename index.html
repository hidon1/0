<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>פורום הצליאק החרדי</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; border-bottom: 2px solid #2c3e50; padding-bottom: 10px; }
        .post-form { background: #e9ecef; padding: 15px; border-radius: 5px; margin-bottom: 30px; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #2c3e50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #34495e; }
        .thread { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px; background: #fff; }
        .reply { margin-right: 30px; border-right: 3px solid #2c3e50; padding-right: 15px; background: #fafafa; margin-top: 10px; }
        .meta { font-size: 0.8em; color: #666; margin-bottom: 5px; }
        .content { font-size: 1em; color: #333; }
    </style>
</head>
<body>

<div class="container">
    <h1>פורום הצליאק החרדי</h1>
    
    <div class="post-form">
        <h3>פתיחת נושא חדש</h3>
        <input type="email" id="email" placeholder="אימייל" required>
        <textarea id="content" rows="3" placeholder="כתוב את שאלתך או הודעתך כאן..." required></textarea>
        <button onclick="submitPost()">שלח הודעה</button>
    </div>

    <div id="forum-content">טוען הודעות...</div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbydT_PduP5eSBj70on0veGW3hUCiuH7wbmy45NYQIOddd_27IZIK7sVeiEYodqEyX4CAg/exec";

    async function loadPosts() {
        const response = await fetch(SCRIPT_URL);
        const data = await response.json();
        const container = document.getElementById('forum-content');
        container.innerHTML = '';

        // ארגון הנתונים לפי שרשורים
        const threads = data.filter(p => !p.ParentID);
        const replies = data.filter(p => p.ParentID);

        threads.forEach(mainPost => {
            let threadHtml = `
                <div class="thread">
                    <div class="meta">${mainPost.Email} | ${new Date(mainPost.Timestamp).toLocaleString('he-IL')}</div>
                    <div class="content"><strong>${mainPost.Content}</strong></div>
                    <button onclick="showReplyForm('${mainPost.ID}')" style="font-size: 12px; margin-top:10px;">הוסף תגובה</button>
                    <div id="replies-${mainPost.ID}"></div>
                </div>`;
            container.innerHTML += threadHtml;
        });

        replies.forEach(reply => {
            const parentDiv = document.getElementById(`replies-${reply.ParentID}`);
            if (parentDiv) {
                parentDiv.innerHTML += `
                    <div class="reply">
                        <div class="meta">${reply.Email} | ${new Date(reply.Timestamp).toLocaleString('he-IL')}</div>
                        <div class="content">${reply.Content}</div>
                    </div>`;
            }
        });
    }

    async function submitPost(parentId = null) {
        const email = document.getElementById('email').value;
        const content = document.getElementById('content').value;

        if (!email || !content) return alert("נא למלא את כל השדות");

        const payload = { email, content, parentId };

        await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(payload)
        });

        alert("הודעתך נשלחה בהצלחה!");
        location.reload();
    }

    function showReplyForm(parentId) {
        const content = prompt("כתוב את תגובתך:");
        const email = document.getElementById('email').value || prompt("הכנס אימייל לתגובה:");
        if (content && email) {
            submitPost(parentId);
        }
    }

    loadPosts();
</script>

</body>
</html>
