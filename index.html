<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¤×•×¨×•× ×”×¦×œ×™××§ ×”×—×¨×“×™ - ×”××”×“×•×¨×” ×”××œ××”</title>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700&family=Heebo:wght@800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #2c3e50; --accent: #d4af37; --bg: #fdfdfd; --card: #ffffff; --text: #333; --info: #e8f4fd;
        }
        [data-theme="dark"] {
            --primary: #1a1a1a; --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; --info: #2c3e50;
        }

        body { 
            font-family: 'Assistant', sans-serif; background: var(--bg); color: var(--text); 
            margin: 0; transition: all 0.3s ease; padding-bottom: 120px;
        }

        header { 
            background: var(--primary); color: white; padding: 3rem 1rem; text-align: center;
            border-bottom: 5px solid var(--accent); position: relative;
        }

        .theme-toggle {
            position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.1); 
            border: 1px solid white; color: white; padding: 8px 15px; cursor: pointer; border-radius: 20px;
        }

        .container { max-width: 1000px; margin: auto; padding: 20px; }

        .nav-tabs { 
            display: flex; gap: 12px; overflow-x: auto; padding: 20px 0; 
            position: sticky; top: 0; background: var(--bg); z-index: 10;
        }
        .tab-btn { 
            background: var(--card); border: 2px solid var(--primary); padding: 10px 25px;
            border-radius: 30px; cursor: pointer; font-weight: bold; color: var(--primary);
            transition: 0.3s; white-space: nowrap;
        }
        .tab-btn.active { background: var(--primary); color: white; }

        .thread-card { 
            background: var(--card); border-radius: 15px; padding: 25px; margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); border-right: 8px solid var(--accent);
            animation: slideUp 0.5s ease-out; cursor: pointer;
        }

        .reply-box { margin-top: 15px; padding: 20px; background: rgba(0,0,0,0.03); border-radius: 10px; display: none; }
        .reply-item { padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.1); }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: var(--card); padding: 30px; border-radius: 15px; width: 95%; max-width: 550px; color: var(--text); }

        input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; background: var(--card); color: var(--text); }
        .btn-main { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; }

        .fab { position: fixed; bottom: 35px; left: 35px; width: 70px; height: 70px; border-radius: 50%; background: var(--accent); color: white; font-size: 35px; border: none; cursor: pointer; box-shadow: 0 8px 25px rgba(0,0,0,0.3); z-index: 99; }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body data-theme="light">

<header>
    <button class="theme-toggle" onclick="toggleTheme()">â˜€ï¸/ğŸŒ™ ××¦×‘ ×ª×¦×•×’×”</button>
    <h1 style="font-family: 'Heebo', sans-serif; margin:0;">×¤×•×¨×•× ×”×¦×œ×™××§ ×”×—×¨×“×™</h1>
    <p>×‘×™×ª ×—× ×œ×¢×–×¨×” ×”×“×“×™×ª ×•××ª×›×•× ×™×</p>
</header>

<div class="container">
    <div class="nav-tabs">
        <button class="tab-btn active" onclick="changeCategory('×”×›×œ', this)">ğŸ  ×”×›×œ</button>
        <button class="tab-btn" onclick="changeCategory('××ª×›×•× ×™×', this)">ğŸ° ××ª×›×•× ×™×</button>
        <button class="tab-btn" onclick="changeCategory('×›×©×¨×•×ª', this)">ğŸ—ï¸ ×›×©×¨×•×ª</button>
        <button class="tab-btn" onclick="changeCategory('×¨×¤×•××™', this)">ğŸ’Š ×¨×¤×•××™</button>
    </div>

    <div id="posts-container">
        <div style="text-align: center; padding: 50px;">×˜×•×¢×Ÿ ×”×•×“×¢×•×ª...</div>
    </div>
</div>

<button class="fab" onclick="document.getElementById('postModal').style.display='flex'">+</button>

<div id="postModal" class="modal">
    <div class="modal-content">
        <h2>×¤×ª×™×—×ª ×©×¨×©×•×¨ ×—×“×©</h2>
        <input type="text" id="name" placeholder="×”×©× ×©×œ×š">
        <select id="category">
            <option value="×›×œ×œ×™">×‘×—×¨ ×§×˜×’×•×¨×™×”</option>
            <option value="××ª×›×•× ×™×">××ª×›×•× ×™×</option>
            <option value="×›×©×¨×•×ª">×›×©×¨×•×ª ×•××¡×¢×“×•×ª</option>
            <option value="×¨×¤×•××™">×©××œ×•×ª ×¨×¤×•××™×•×ª</option>
        </select>
        <input type="text" id="subject" placeholder="× ×•×©× ×”×”×•×“×¢×”">
        <textarea id="content" rows="5" placeholder="×ª×•×›×Ÿ ×”×”×•×“×¢×”..."></textarea>
        <button class="btn-main" onclick="sendPost()">×¤×¨×¡× ×¢×›×©×™×•</button>
        <button class="btn-main" style="background:#999; margin-top:8px;" onclick="document.getElementById('postModal').style.display='none'">×¡×’×•×¨</button>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzcB4Ur9EiWQCKpdeA3Cdjd_seyapLuQIoHenUcbsqTIArh5yVUrBuKGJADcwT9YPFntg/exec";
    let allPosts = [];

    async function loadData() {
        try {
            const res = await fetch(SCRIPT_URL);
            allPosts = await res.json();
            render('×”×›×œ');
        } catch(e) { document.getElementById('posts-container').innerHTML = "×©×’×™××” ×‘×˜×¢×™× ×”."; }
    }

    function render(category) {
        const container = document.getElementById('posts-container');
        container.innerHTML = '';
        
        const filtered = category === '×”×›×œ' ? allPosts : allPosts.filter(p => p.Category === category);
        
        filtered.filter(p => p.ID).forEach(t => {
            const replies = allPosts.filter(r => r.ParentID === t.ID);
            container.innerHTML += `
                <div class="thread-card" onclick="toggleReplies('${t.ID}')">
                    <small>${t.Category} | ${new Date(t.Timestamp).toLocaleDateString('he-IL')}</small>
                    <h3>${t.Subject}</h3>
                    <p>${t.Content}</p>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span>×××ª: <strong>${t.Name}</strong></span>
                        <div>
                            <button class="tab-btn" style="padding:5px 15px" onclick="event.stopPropagation(); addLike('${t.ID}')">â¤ï¸ ${t.Likes || 0}</button>
                        </div>
                    </div>
                    
                    <div id="box-${t.ID}" class="reply-box" onclick="event.stopPropagation()">
                        <h4>×ª×’×•×‘×•×ª (${replies.length}):</h4>
                        ${replies.map(r => `<div class="reply-item"><strong>${r.Name}:</strong> ${r.Content}</div>`).join('')}
                        <div style="margin-top:15px; display:flex; gap:5px;">
                            <input type="text" id="rep-in-${t.ID}" placeholder="×›×ª×•×‘ ×ª×’×•×‘×”...">
                            <button class="tab-btn active" onclick="sendReply('${t.ID}')">×©×œ×—</button>
                        </div>
                    </div>
                </div>
            `;
        });
    }

    async function sendPost() {
        const payload = {
            name: document.getElementById('name').value,
            category: document.getElementById('category').value,
            subject: document.getElementById('subject').value,
            content: document.getElementById('content').value
        };
        await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
        location.reload();
    }

    async function sendReply(parentId) {
        const content = document.getElementById(`rep-in-${parentId}`).value;
        const name = prompt("×”×©× ×©×œ×š ×œ×ª×’×•×‘×”:");
        if(!name || !content) return;
        await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ name, content, parentId }) });
        location.reload();
    }

    async function addLike(id) {
        await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({action: "like", id: id}) });
        loadData();
    }

    function toggleReplies(id) {
        const el = document.getElementById(`box-${id}`);
        el.style.display = el.style.display === 'block' ? 'none' : 'block';
    }

    function changeCategory(cat, btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        render(cat);
    }

    function toggleTheme() {
        document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    }

    loadData();
</script>
</body>
</html>
